generator client {
  provider = "prisma-client"
  output   = "../prisma/generated"
}

datasource db {
  provider = "postgresql"
}

//////////////////////
// USER
//////////////////////

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  telephone String?
  name      String?

  strains   Strain[]
  seeds     Seed[]
  plants    Plant[]
  harvests  Harvest[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  active    Boolean  @default(true)

  @@index([id])
  @@index([active])
}


//////////////////////
// STRAINS (CATALOG)
//////////////////////

model Strain {
  id            String @id @default(uuid())
  code          String @unique                // EXTERNAL (ST-001-0001)
  name          String
  type          StrainType
  genetics      String
  thc           String
  cbd           String
  floweringTime String
  description   String
  dateAdded     DateTime

  origin        String?
  breeder       String?
  difficulty    GrowDifficulty?
  yield         YieldLevel?
  preferredEnv  String?
  resistance    String?
  growthPattern String?
  gennetics     String?
  effects       String?
  terpenes      String?
  medicalUses   String?

  userId        String
  user          User       @relation(fields: [userId], references: [id])

  seeds         Seed[]
  plants        Plant[]

  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  active        Boolean  @default(true)

  @@index([code])
  @@index([userId])
  @@unique([userId, name])
  @@index([userId, active])
}

//////////////////////
// SEEDS
//////////////////////

model Seed {
  id                 String @id @default(uuid())
  code               String @unique                // EXTERNAL (SD-001-0001)
  name               String
  nombreCultivar     String
  country            String
  harvestYear        String
  inscriptionCode    String
  flavour            String
  daysTillHarvest    String
  dateAdded          DateTime
  totalSeeds         Int

  germinationRate    String?
  supplier           String?
  batchNumber        String?
  feminized          Boolean?
  autoflowering      Boolean?
  viabilityTest      String?
  storageConditions  String?
  expirationDate     DateTime?
  parentGeneration   String?
  collectionMethod   String?
  processingDate     DateTime?
  flavorProfile      String?

  strainId          String
  strain            Strain   @relation(fields: [strainId], references: [id])

  userId            String
  user              User     @relation(fields: [userId], references: [id])

  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  active            Boolean  @default(true)

  @@index([code])
  @@index([userId])
  @@index([strainId])
  @@index([userId, active])
}

//////////////////////
// HARVESTS (GROW CYCLES / BATCHES)
//////////////////////

model Harvest {
  id           String @id @default(uuid())
  code         String @unique                // EXTERNAL (HV-001-0001)
  name         String

  // Lifecycle
  startDate    DateTime
  endDate      DateTime?
  status       HarvestStatus
  harvestType  HarvestType
  notes        String?

  // Processing details
  harvestMethod     String?
  dryingMethod      String?
  dryingLocation    String?
  curingMethod      String?
  qualityGrade      QualityGrade?
  totalYield        String?

  // Environmental conditions
  dryingTemperature String?
  dryingHumidity    String?
  moistureContent   String?
  trimLoss          String?

  // Ownership
  userId        String
  user          User           @relation(fields: [userId], references: [id])

  // Relations
  plants        Plant[]
  timeline      HarvestTimeline[]

  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  active        Boolean  @default(true)

  @@index([code])
  @@index([userId])
  @@index([userId, active, createdAt])
}

//////////////////////
// HARVEST TIMELINE
//////////////////////

model HarvestTimeline {
  id          String @id @default(uuid())
  date        DateTime
  event       HarvestTimelineEvent
  description String?

  harvestId   String
  harvest     Harvest  @relation(fields: [harvestId], references: [id])

  @@index([harvestId])
}



//////////////////////
// PLANTS
//////////////////////

model Plant {
  id               String @id @default(uuid())
  code             String @unique                // EXTERNAL (PL-001-0001)
  status           PlantStatus
  plantedDate      DateTime
  floweringDate    DateTime?
  expectedHarvest  DateTime
  height           Int?
  health           PlantHealth
  location         String
  notes            String?
  image            String?

  // Growth state
  age               Int?
  currentWeek       String?
  lightCycle        String?
  nutrients         String?
  ph                String?
  ec                String?
  temperature       String?
  humidity          String?
  training          String?
  lastWatered       DateTime?
  nextWatering      DateTime?
  expectedFlowering DateTime?
  potSize           String?

  // Harvest outcome (belongs to the plant)
  wetWeight         String?
  dryWeight         String?
  quality           QualityGrade?

  // Relations
  strainId          String
  strain            Strain        @relation(fields: [strainId], references: [id])

  harvestId         String
  harvest           Harvest       @relation(fields: [harvestId], references: [id])

  userId            String
  user              User          @relation(fields: [userId], references: [id])

  growthLogs        PlantGrowthLog[]

  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  active            Boolean  @default(true)

  @@index([code])
  @@index([userId])
  @@index([strainId])
  @@index([harvestId])
  @@index([userId, active])
}

//////////////////////
// PLANT GROWTH LOGS
//////////////////////

model PlantGrowthLog {
  id          String @id @default(uuid())
  date        DateTime
  type        PlantGrowthLogType
  phase       PlantPhase

  notes       String?

  plantId     String
  plant       Plant @relation(fields: [plantId], references: [id])

  nutrientLog   NutrientLog?
  treatmentLog  TreatmentLog?
  pestLog       PestLog?
  trainingLog   TrainingLog?
  measurement   GrowthMeasurement?

  createdAt   DateTime @default(now())

  @@index([plantId])
  @@index([type])
  @@index([date])
}

model GrowthMeasurement {
  id              String @id @default(uuid())
  heightCm        Int?
  widthCm         Int?
  nodeCount       Int?
  leafColor       String?
  vigorScore      Int? // 1â€“10

  temperature     String?
  humidity        String?
  ph              String?
  ec              String?

  logId           String @unique
  log             PlantGrowthLog @relation(fields: [logId], references: [id])
}

model NutrientLog {
  id              String @id @default(uuid())
  nutrientName    String
  brand           String?
  dosage          String
  method          NutrientApplicationMethod
  phAdjusted      Boolean?
  ecValue         String?
  runoffObserved  Boolean?

  logId           String @unique
  log             PlantGrowthLog @relation(fields: [logId], references: [id])
}

model TreatmentLog {
  id              String @id @default(uuid())
  treatmentType   TreatmentType
  productName     String?
  reason          String
  dosage          String?
  appliedBy       String?

  logId           String @unique
  log             PlantGrowthLog @relation(fields: [logId], references: [id])
}

model PestLog {
  id              String @id @default(uuid())
  pestType        PestType
  severity        PestSeverity
  affectedArea    String?
  symptoms        String
  actionTaken     String?

  resolved        Boolean @default(false)

  logId           String @unique
  log             PlantGrowthLog @relation(fields: [logId], references: [id])
}

model TrainingLog {
  id              String @id @default(uuid())
  technique        TrainingTechnique
  intensity        TrainingIntensity?
  description      String?

  logId            String @unique
  log              PlantGrowthLog @relation(fields: [logId], references: [id])
}

//////////////////////
// ENUMS
//////////////////////

enum NutrientApplicationMethod {
  SOIL
  FOLIAR
  HYDROPONIC
}

enum TrainingTechnique {
  TOPPING
  FIM
  LST
  HST
  SCROG
  DEFOLIATION
}

enum TrainingIntensity {
  LIGHT
  MODERATE
  AGGRESSIVE
}

enum PestType {
  MITES
  THRIPS
  APHIDS
  FUNGUS_GNATS
  MOLD
  MILDEW
  UNKNOWN
}

enum PestSeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum TreatmentType {
  ROOT_STIMULANT
  FUNGICIDE
  INSECTICIDE
  HORMONE
  STRESS_RECOVERY
  DEFICIENCY_CORRECTION
}

enum PlantGrowthLogType {
  MEASUREMENT
  NUTRIENTS
  SPECIAL_TREATMENT
  PEST_ISSUE
  TRAINING
}


enum PlantStatus {
  SEEDLING
  VEGETATIVE
  FLOWERING
  READY_TO_HARVEST
  HARVESTED
}

enum PlantHealth {
  EXCELLENT
  GOOD
  FAIR
  POOR
}

enum PlantPhase {
  SEEDLING
  VEGETATIVE
  FLOWERING
}

enum StrainType {
  INDICA
  SATIVA
  HYBRID
  INDICA_DOMINANT
  SATIVA_DOMINANT
}

enum HarvestStatus {
  COMPLETED
  IN_PROGRESS
}

enum HarvestType {
  FOTO_PERIODICA
  AUTOMATICA
}

enum QualityGrade {
  PREMIUM
  EXCELLENT
  GOOD
  FAIR
  POOR
}

enum GrowDifficulty {
  EASY
  MODERATE
  DIFFICULT
}

enum YieldLevel {
  LOW
  MEDIUM
  HIGH
}

enum HarvestTimelineEvent {
  // Pre-harvest / growing
  SEED_PLANTED
  PLANTED_IN_POT
  MOVED_TO_SOIL
  VEGETATIVE_STARTED
  FLOWERING_STARTED

  // Harvest phase
  HARVEST_STARTED

  // Processing
  WET_TRIM_COMPLETE
  DRYING_STARTED
  DRYING_COMPLETE
  DRY_TRIM
  CURING_STARTED
  CURING_COMPLETE
}